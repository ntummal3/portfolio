name: Deploy static content to Pages

on:
  push:
    branches: ["main"]

  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Generate static site
        run: |
          mkdir -p _site
          cp -r static _site/
          cat > generate_site.py << 'EOF'
          import json
          from app import portfolio_data
          
          html = f"""<!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>{portfolio_data["name"]} - Portfolio</title>
              <link rel="stylesheet" href="static/css/style.css">
              <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
              <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
          </head>
          <body>
              <nav class="navbar">
                  <div class="nav-content">
                      <a href="#" class="logo">NT</a>
                      <div class="nav-links">
                          <a href="#about">About</a>
                          <a href="#education">Education</a>
                          <a href="#skills">Skills</a>
                          <a href="#experience">Experience</a>
                          <a href="#projects">Projects</a>
                          <a href="#contact">Contact</a>
                      </div>
                  </div>
              </nav>
              <section class="hero" id="about">
                  <div class="hero-content">
                      <h1>{portfolio_data["name"]}</h1>
                      <p>{portfolio_data["title"]}</p>
                      <p>{portfolio_data["location"]} | <a href="mailto:{portfolio_data["email"]}" style="color: white;">{portfolio_data["email"]}</a></p>
                      <div style="margin-top: 20px;">
                          <a href="https://{portfolio_data["linkedin"]}" target="_blank" class="btn">
                              <i class="fab fa-linkedin"></i> LinkedIn
                          </a>
                      </div>
                      <div class="bio-section">
                          <p>{portfolio_data["bio"]}</p>
                      </div>
                  </div>
              </section>
              <section class="section" id="education">
                  <div class="section-content">
                      <h2 class="section-title">Education</h2>
                      <div class="timeline">
                          {"".join(f'''
                          <div class="timeline-item">
                              <div class="timeline-date">{edu["date"]}</div>
                              <h3>{edu["school"]}</h3>
                              <p>{edu["degree"]} - GPA: {edu["gpa"]}</p>
                              {"<p><strong>Relevant Courses:</strong> " + edu["courses"] + "</p>" if "courses" in edu else ""}
                          </div>
                          ''' for edu in portfolio_data["education"])}
                      </div>
                  </div>
              </section>
              <section class="section" id="skills">
                  <div class="section-content">
                      <h2 class="section-title">Skills</h2>
                      <div class="skills-container">
                          <div class="skill-category">
                              <h3>Programming Languages</h3>
                              <ul class="skill-list">
                                  {"".join(f"<li>{skill}</li>" for skill in portfolio_data["skills"]["languages"])}
                              </ul>
                          </div>
                          <div class="skill-category">
                              <h3>Tools & Frameworks</h3>
                              <ul class="skill-list">
                                  {"".join(f"<li>{skill}</li>" for skill in portfolio_data["skills"]["tools"])}
                              </ul>
                          </div>
                          <div class="skill-category">
                              <h3>Cloud Technologies</h3>
                              <ul class="skill-list">
                                  {"".join(f"<li>{skill}</li>" for skill in portfolio_data["skills"]["cloud"])}
                              </ul>
                          </div>
                          <div class="skill-category">
                              <h3>Machine Learning</h3>
                              <ul class="skill-list">
                                  {"".join(f"<li>{skill}</li>" for skill in portfolio_data["skills"]["ml"])}
                              </ul>
                          </div>
                      </div>
                  </div>
              </section>
              <section class="section" id="experience">
                  <div class="section-content">
                      <h2 class="section-title">Experience</h2>
                      <div class="timeline">
                          {"".join(f'''
                          <div class="timeline-item">
                              <div class="timeline-date">{exp["date"]}</div>
                              <h3>{exp["title"]}</h3>
                              <h4>{exp["company"]}</h4>
                              <ul>
                                  {"".join(f"<li>{achievement}</li>" for achievement in exp["achievements"])}
                              </ul>
                          </div>
                          ''' for exp in portfolio_data["experience"])}
                      </div>
                  </div>
              </section>
              <section class="section" id="projects">
                  <div class="section-content">
                      <h2 class="section-title">Projects</h2>
                      <div class="projects-grid">
                          {"".join(f'''
                          <div class="project-card">
                              <div class="project-content">
                                  <h3 class="project-title">{project["title"]}</h3>
                                  <p>{project["description"]}</p>
                                  <div style="margin: 10px 0;">
                                      {"".join(f'<span style="background: var(--secondary-color); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; margin-right: 5px;">{tech}</span>' for tech in project["technologies"])}
                                  </div>
                                  <ul>
                                      {"".join(f"<li>{highlight}</li>" for highlight in project["highlights"])}
                                  </ul>
                              </div>
                          </div>
                          ''' for project in portfolio_data["projects"])}
                      </div>
                  </div>
              </section>
              <section class="section" id="contact">
                  <div class="section-content">
                      <h2 class="section-title">Contact Me</h2>
                      <form class="contact-form" action="#contact" method="POST">
                          <div class="form-group">
                              <label for="name">Name</label>
                              <input type="text" id="name" name="name" required>
                          </div>
                          <div class="form-group">
                              <label for="email">Email</label>
                              <input type="email" id="email" name="email" required>
                          </div>
                          <div class="form-group">
                              <label for="message">Message</label>
                              <textarea id="message" name="message" rows="5" required></textarea>
                          </div>
                          <button type="submit" class="btn">Send Message</button>
                      </form>
                  </div>
              </section>
              <script>
                  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                      anchor.addEventListener("click", function (e) {
                          e.preventDefault();
                          document.querySelector(this.getAttribute("href")).scrollIntoView({
                              behavior: "smooth"
                          });
                      });
                  });
                  window.addEventListener("scroll", function() {
                      if (window.scrollY > 50) {
                          document.querySelector(".navbar").style.backgroundColor = "rgba(255, 255, 255, 0.95)";
                      } else {
                          document.querySelector(".navbar").style.backgroundColor = "rgba(255, 255, 255, 0.9)";
                      }
                  });
              </script>
          </body>
          </html>"""
          
          with open("_site/index.html", "w") as f:
              f.write(html)
          EOF
          python generate_site.py

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '_site'
          
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 